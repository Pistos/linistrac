<div class="ticket">

  <h3 class="title">#{@t.title}</h3>
  
  <table>
  <tr>
    <td>Opened:</td><td>#{@t.time_created_s}</td>
    <td>Updated:</td><td>#{@t.time_updated_s}</td>
  </tr>
  <tr>
    <td>Status:</td><td>#{@t.status}</td>
    <td>Created by:</td><td>#{@t.creator_name}</td>
  </tr>
  <tr>
    <td>Severity:</td><td>#{@t.severity}</td>
    <td>Priority:</td><td>#{@t.priority}</td>
  </tr>
  <tr>
    <td>Group:</td><td>#{@t.group}</td>
  </tr>
  <tr>
    <td>Tags:</td><td>#{@t.tags}</td>
  </tr>
  
  </table>
  
  <h4 class="description-title">Description</h4>
  
  <div class="description">#{@t.description}</div>

</div>

<form method="POST" action="/ticket/update/#{@t.id}">
  <table>
  <tr>
    <td>Resolution:</td>
    <td>
      <select name="resolution_id">
        <?r @resolutions.each do |r| ?>
          <option value="#{r.id}" title="#{r.description}" #{'selected' if @t.resolution_id == r.id}>#{r.name}</option>
        <?r end ?>
      </select>
    </td>
  </tr>
  </table>
  
  <input type="submit" value="Update"/>
</form>

<div class="changelog">

  <h3>Change Log</h3>

<?r @deltas.each do |delta|
  if TicketDelta === delta
    ?>
    <div class="ticket-delta">
      <span class="header">
        <span class="author">#{delta.changer}</span> at
        <span class="timestamp">#{delta.time_s}</span>
      </span>
      <div class="text">
        <ul>
        <?r delta.changes.each do |c| ?>
          <li><b>#{c[:key]}</b> changed from #{c[:old]} to <b>#{c[:new]}</b></li>
        <?r end ?>
        </ul>
      </div>
    </div>
  <?r elsif Comment === delta
    comment = delta
    next if comment.is_spam
    ?>
    <div class="comment">
      <span class="header">
        <span class="author">#{comment.author_name}</span> at
        <span class="timestamp">#{comment.time_created_s}</span>
        <a class="para" id="comment-#{comment.id}" href="#comment-#{comment.id}">&para;</a>
      </span>
      <div class="text">#{comment.text}</div>
    </div>
    
  <?r end ?>

<?r end ?>

</div>

<form method="POST" id="add-comment">
  <table>
  <tr>
    <td>Your name:</td>
    <td>
      <?r if @user ?>
        #{@user.username}
      <?r else ?>
        <input type="text" name="author-name" cols="30"/>
      <?r end ?>
    </td>
  </tr>
  <tr><td>Comment:</td><td><textarea name="text" rows="7" cols="60"></textarea></td></tr>
  </table>
  <input type="submit" value="Add Comment"/>
</form>

