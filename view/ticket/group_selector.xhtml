<?r if not @groups.empty? ?>
  <span class="group-selector #{@css_class}" id="#{@id}">
    <select #{ 'name="group_id"' if @groups.include? @t.group }>
      <option>(subgroup)</option>
      <?r @groups.each do |g| ?>
        <option value="#{g.id}" #{ @selected_groups.include?( g ) ? 'selected' : '' }>#{g.name}</option>
      <?r end ?>
    </select>
    
    <?r @groups.each do |g| ?>
      #{
      render_template(
        'group_selector.xhtml',
        {
          :groups => g.children,
          :css_class => ( 'hidden-group' if ( @selected_groups & g.children ).empty? ),
          :id => "children-of-#{g.id}",
        }
      )
      }
    <?r end ?>
  </span>
<?r end ?>
